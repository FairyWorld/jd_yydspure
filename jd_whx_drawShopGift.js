/*
关注有礼-自动解析通用
环境变量 样例
export whx_drawShopGift="https://u.jd.com/VtcZjCp"
7 7 7 7 7 jd_whx_drawShopGift.js
*/
const $ = new Env('关注有礼-自动解析通用');
const notify = $.isNode() ? require('./sendNotify') : '';
const axios = require("axios")
const jdCookieNode = $.isNode() ? require('./jdCookie.js') : '';
let cookiesArr = [], cookie = '';
let jfurl = process.env.whx_drawShopGift ?? "";

if ($.isNode()) {
  Object.keys(jdCookieNode).forEach((item) => {
    cookiesArr.push(jdCookieNode[item])
  })
  if (process.env.JD_DEBUG && process.env.JD_DEBUG === 'false') console.log = () => {
  };
} else {
  cookiesArr = [$.getdata('CookieJD'), $.getdata('CookieJD2'), ...jsonParse($.getdata('CookiesJD') || "[]").map(item => item.cookie)].filter(item => !!item);
}
!(async () => {
  if (!cookiesArr[0]) {
    $.msg($.name, '【提示】请先获取京东账号一cookie\n直接使用NobyDa的京东签到获取', 'https://bean.m.jd.com/bean/signIndex.action', { "open-url": "https://bean.m.jd.com/bean/signIndex.action" });
    return;
  }
  for (let i = 0; i < cookiesArr.length; i++) {
    if (cookiesArr[i]) {
      cookie = cookiesArr[i];
      $.UserName = decodeURIComponent(cookie.match(/pt_pin=([^; ]+)(?=;?)/) && cookie.match(/pt_pin=([^; ]+)(?=;?)/)[1])
      $.index = i + 1;
      $.isLogin = true;
      $.nickName = '';
      message = '';
      await TotalBean();
      console.log(`\n******开始【京东账号${$.index}】${$.nickName || $.UserName}*********\n`);
      if (!$.isLogin) {
        $.msg($.name, `【提示】cookie已失效`, `京东账号${$.index} ${$.nickName || $.UserName}\n请重新登录获取\nhttps://bean.m.jd.com/bean/signIndex.action`, { "open-url": "https://bean.m.jd.com/bean/signIndex.action" });
        if ($.isNode()) {
          // await notify.sendNotify(`${$.name}cookie已失效 - ${$.UserName}`, `京东账号${$.index} ${$.UserName}\n请重新登录获取cookie`);
        }
        continue
      }
      $.jfurl = jfurl
      $.hrl = ''
      $.shopId = ''
      $.gx = ''
      $.utm_campaign = ''
      $.utm_term = ''
      $.activityId = ''
      await main()
      await $.wait(2000);
    }
  }
})().catch((e) => { $.log('', `❌ ${$.name}, 失败! 原因: ${e}!`, '') }).finally(() => { $.done(); })

async function main(){
  await getShorttoLong()
  await whx_getShopHomeActivityInfo()
  if ($.activityId) {
    await whx_drawShopGift()
  }
}

async function getShort(short) {
  try {
      let { data } = await axios.get(short);
      if (data) {
          let jump = data.match(/hrl=\'(.*)\';var.ua/)[1];
          if (jump) {
              return await axios
                  .get(jump)
                  .then((res) => {
                      return res.request?._redirectable?._currentUrl;
                  })
                  .catch((err) => {
                      return err.request?._redirectable?._currentUrl;
                  });
          } else {
              return null;
          }
      } else {
          return null;
      }
  } catch (error) {
      return null;
  }
}
var _0xod2='jsjiami.com.v6',_0xod2_=['‮_0xod2'],_0x1a16=[_0xod2,'wpDDq8KUw6jChQ==','BcKjw6nDl8KE','RMOyIg==','N3wFVg==','BMOzw5dY6Kyr5rOH5aWr6LWF772N6K6H5qKy5p+X57+g6Lex6YaL6K6W','dy0Ww5U1','NsKhE2LCoQ==','wrvCkcKgWsKJ','L8KzLX7CozXDuQ==','woTDh8OowrpV','w6Rmw7bDtMOU','TcKIwr0eTg==','w5HCinHDn3o=','w4t3wqDDulTCvsKHwpk=','TwU3w5o=','wqTDi8Klw6nCvFPCo8K6','wq7DosO/JcOuDcO/Ag==','KAIaw7lI','HjbCmsOWw5pQwr0=','K3gbRhvDnA==','AsKgw4vDtgsIBzs7QMKwNW8xH8OaRnDDtkE=','JyzCtcKIfcKEd10=','KsKvBlTCti4=','w7vCjsOnFcO2','wpbCnsKmXMKJ','wozCqg3CpjAX','YMKHe3sN','YsKDen0EwpI=','YsKDaHo/woluVg==','FMK8w4LDhMKS','w4LDpsOmG8KO','dAXDpsKJOsKoSQ==','wrjDh8K1w7fCvkY=','DT/CjMOkw5RGwqBTdlRiw6hbw4LDh8KsOcOBwr7DkA==','wqIMAHHDg0ledw==','WcK3Hw==','VcKUw642Qw==','wq/Ci8KKwoo5','FMOMYCJ0','c8Kjw7Q=','QDB0','5Lu25Lma5pyp5Yij5ZiY6Lye5Zmc56uR5pWB5oyP','wqDDjsOwwptxwqzCkcOwwq4=','IDvCi8Ouw70dd8OKw5XDhAE=','VsKtwrEMUA==','w4XDkMOfBcKRw4gDLE3Dm8Olwq9bw6Eww7PDkB5hLsOs','EsOneTdWe8KC','w4/DmCzDkVx0YA==','Wh9C','wqbChTDCpx8XfA==','wp92w7Fow5rDpwEGw51BS8OqBQ==','chLDt8K7','M3QGVBHDjcKh','AjjDtsO+IMOswq0nK8KU','DsOhw4rDuwUc','wrbDm8ONw73ClmY=','eMKUZQ==','wpgKGGnDlw==','w69xwqc=','wpLDo8Oyw4DCqw==','HcKaw6Amw60=','DsKVDmjCsQ==','SBMSd1PDg8K6NcOLHsO0aw==','w5HCl0U=','HsKJw5/DscKE','IBXDtsKzCsKuSMKIXcKJ','WMKdw7Ijw44WAsOd','ESoe','woRtw6s=','eBMZXEQ=','F8K7w7/DtSE=','wrXDpcO1wpt5','NCzCksOYw78RccOe','wrhGw6VVw7Q=','wqzDkcOfwqlg','wpPDpcOuJ8OTVsK9SHt7NMKGHFMtw7rCjsOTw6bDi2PCvcKKw7rCriTCtsKDaQTDlMOlXzfDnsKNIcOqw7rCmsOkwprDk8K8PzArWMKfJsKhSHkTbcOeDUbCuMKdfWh4w43CpQ0TDMKOw7JrwpEwUnMkRsKJwqY=','LzfCiA==','GwYPWFnDhsOqNsOCGMOjWgpmwoUQw5bDjkbCtlcjPsOeMDp6wo1zJiNGw6ZCw7IGdMKAwpk7dgMrwoI8wqcPw690KlfDk8O8e8Obw7TDukkQNQ==','F0hV','csK3VUc9','VnF0wpovwqXCk8OyXMO9w4bCvSrCrSvDqsK+','QcKAT1ID','TMOGw7Nhwq/Cv3VPMhgdQsKfc2gpKVPCvMOQUcOi','MMKlD3XCoS7DnlfChw==','w4jCh8OyM8O2','e8OnIMOeAg==','Vggew758','w5LDnMOg','w5XCik4=','wr4IDGY=','w7bDqsOOwrbor6Pmspzlp6notrHvvoLor7Lmo5rmnZnnv6HotoLphJrorYs=','d8K+w78=','wqMdE2rDukFFdcOw','ClYlcFg=','w7DCusOQNMOiwrk=','UQIJTVzDuMKyN8OFOsO2awlawpIL','GCwPw6dwEcORJcKld3vDhFYOw53Cq8OO','w7V7wq4WwojDhkXDlw==','w49aw6vDp8OK','XwE3w4oOQg==','KsKlF3TCqAbDskHDlTYCPl/Duztx','LCNKw6YVwrjDi8OPDA==','wrDCvcKbe8K9','Flgw','TDjDk8KsLQ==','RGBZwolO','wrEKFWrDok9YasOAeA==','w6VWw43DgMOfSg==','wpzDuMO8I8OiDcO1I3t/PMO6FA4yw7LDlA==','acOHw4VAwp96wqgTT3A=','D8Kjw54=','ajclw4JV','YDZCw6nDhA==','w47DksO1FWU=','NMKlEmTCqCg=','w5DDlTXDhHlKJcK4wonCmsKqSsOAwqvCnkg=','w5/DgcOYAMKOwoY=','WwEqw5sHRMKRJQ==','AcK1BnLChw==','wqTDjsOtwop4wqo=','w5LDlsOxA2zDgMO2wpxvwqrDs35wXndn','JsK/w7M5w6U=','w7YKCWLDukhJf8K0','HwXDs8OsAQ==','bcK0w7YnQUghw4g=','w53DkzfDiGN5NMKzwq/Csw==','w57CjE/Dh1LCtBpRCUDCvsOowrVDLwgz','w4o6IUkBJsKtwoRSw7o=','w4HDi8OM','w7nDusOLFm4=','AMOsYi5pdsOLSsOkTQ==','wovDt3o=','5Lmm5Lq+5p+L5Yij5Zq66L+m5ZiQ56ql5paX5o6P','w5XCik7DtmLCpw==','wrrDhMO5','e8OQw4NAwod0wrUMfw==','TwILS1/DhsKy','asOFw4JM','wpE5MVTDuA==','wofCvwPCk25Fwp/CssOIwozDg8Ksw7ZbwqVkw7o=','wprCrUfCoAxJwoHCv8KDwqjDg8K2w6BMw7Q7wrhTw6A=','wqvCgsKI','wqTDjcKx','Wjp9w4LDlcO4Exc=','wrPDjsO0wpZC','w5t7w5/DosOh','NcKhGFPCiQ==','XBEww48n','w74SOFU5','UMKawrUOXw==','GS0Rw7VZ','AsKvw5/DicKB','PzbDjcO9BA==','w6xpQsOYw47DpToJwpLCrjTDtsKjT0/Dt3PDlcKZX8KDwpVAwrbCrU7DqCXCtGE1w7VqIcKRwrRTCm3CscK2w5DDnmQgIsKpPW/CtkdldsK1e8ONwoQAHXvCtsOHwrTDjMKow7BIw40=','MizCjcOuw6UTasOVw6U=','XGgjPg==','w61xwrc=','RyXDtsKvEA==','w6DDi8ORHMKOwp5NLAvCncK6w79dw6VOw7HDm15nesKhw5vClj45TBxgw7nCv8KROcO7TcK0w6Zww5HDt0U4WMOFwoR1OsK9wqxwKMOwwrvDkB3CvsKneikOwpbDo8ObdHfDnU3Cp8OHHUTDicOFwpXCpW3DrsKBw77CnsOlwqVjK8O6ZQoyw7TDtFvCrcOqw7VAw61Ww63CgHY2wqsWVWxKScKBw5PDtMODGWzDicKTIMKlw7MwcC4lVy7ClB/DlFDDisOmWsKxwrrDoR8KR8Kow7wk','UsK9DA==','w67CsMOE','wpPCsRjCiiwCwpLCscOX','wpDCpBjCkCc=','w6AcGHEW','BRrCucKiag==','wpTDgcOCNcOi','YsOCw4RbwoU=','MsKoBH8=','woMwIFbDlQ==','wpbDqsOjw5jCng==','TwIMXVzDlg==','R0TCj8KPwpfCmlXDisOMYgnDi8K1JEcDwpsfWzE=','w4zDlsO0E2zDrg==','wonDtMO7JcO3A8OgAw==','w6zDugLDkVw=','w7R8RMObw5g=','wqIMFWDDu0JJ','esKBwpsMXg==','N3QLWDnDicKiFQ==','XjYlw5kz','wpTDinzDrCw=','UsKXfGkUUMOeJQ==','aBQaWn7Dg8K6IA==','wo3Ct8KV','wqnCgsKYwr0nIQ==','w7HCi0zDq1s=','KDbCm8Oiw7M7ZQ==','wpLDv8O+MsOYI8O0','wp1sw61/w5A=','wqnCoMK1XMKU','XsKcw70Pw44BGcOeAg==','CkQpZjY=','VAkbTUjDrcKx','UgTDp8KTBQ==','w5TCgDHCtSA=','QCsmw4J7woPDjMOYw4Y=','CT7Cr8Otw7g=','w7F7wrQRwoLDkGk=','AsK8w4nDvwMPHx03TMK7c2F5DMOqWDvDpF1JGm7CoMK6w6pWOi/CuXoFwow=','STZpw5Jh','woJ2w6hHw4rCvENZw4tZX8KqUsK0Px7DhsOtesKswovDoigww4fDgXzDqcOOeMK7LRJPwqUfdcKwwrLDs8OKHE1cwrt2woo/w4s=','DCpjw4AJ','wrHDtFrDiAQ=','LcKHw4EEw6d1GsK9w4s3XMOcPDHCrz1owo8OOsOIw5DCvDlFKT1ywofCt8Olwo/CsiYEfxYoc3PCqiYpw5rDgsOACTTCs8ODKR3DqMKt','Sj8xw7N1','ZcOLw6RCwrg=','wq7DlsOHw73DsmPCrBx0Rg==','ZTw0w5gD','wpQMKm/DmA==','w53Di8OYAQ==','MjdpsjihamFi.comW.v6bzUFSMyp=='];if(function(_0x550e54,_0x2bded9,_0x2077da){function _0x4d7fb9(_0x248ca8,_0x56643f,_0x134a0a,_0x2931fd,_0x4348b5,_0x5d4e1b){_0x56643f=_0x56643f>>0x8,_0x4348b5='po';var _0x3fa0f='shift',_0x2a641f='push',_0x5d4e1b='‮';if(_0x56643f<_0x248ca8){while(--_0x248ca8){_0x2931fd=_0x550e54[_0x3fa0f]();if(_0x56643f===_0x248ca8&&_0x5d4e1b==='‮'&&_0x5d4e1b['length']===0x1){_0x56643f=_0x2931fd,_0x134a0a=_0x550e54[_0x4348b5+'p']();}else if(_0x56643f&&_0x134a0a['replace'](/[MdphFWbzUFSMyp=]/g,'')===_0x56643f){_0x550e54[_0x2a641f](_0x2931fd);}}_0x550e54[_0x2a641f](_0x550e54[_0x3fa0f]());}return 0x101706;};return _0x4d7fb9(++_0x2bded9,_0x2077da)>>_0x2bded9^_0x2077da;}(_0x1a16,0x1c8,0x1c800),_0x1a16){_0xod2_=_0x1a16['length']^0x1c8;};function _0x2f2b(_0x4ab770,_0x479e36){_0x4ab770=~~'0x'['concat'](_0x4ab770['slice'](0x1));var _0x3ad750=_0x1a16[_0x4ab770];if(_0x2f2b['hkXQvK']===undefined){(function(){var _0x4530b4=typeof window!=='undefined'?window:typeof process==='object'&&typeof require==='function'&&typeof global==='object'?global:this;var _0x497de9='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x4530b4['atob']||(_0x4530b4['atob']=function(_0x28bae3){var _0x134296=String(_0x28bae3)['replace'](/=+$/,'');for(var _0x1634e9=0x0,_0x3c2af5,_0x268b13,_0x24994a=0x0,_0x4c50ce='';_0x268b13=_0x134296['charAt'](_0x24994a++);~_0x268b13&&(_0x3c2af5=_0x1634e9%0x4?_0x3c2af5*0x40+_0x268b13:_0x268b13,_0x1634e9++%0x4)?_0x4c50ce+=String['fromCharCode'](0xff&_0x3c2af5>>(-0x2*_0x1634e9&0x6)):0x0){_0x268b13=_0x497de9['indexOf'](_0x268b13);}return _0x4c50ce;});}());function _0x2357b8(_0x579dc5,_0x479e36){var _0xfb0754=[],_0x51bafe=0x0,_0xeaa035,_0x4d4353='',_0x4c197a='';_0x579dc5=atob(_0x579dc5);for(var _0x9a7bae=0x0,_0x5f27d9=_0x579dc5['length'];_0x9a7bae<_0x5f27d9;_0x9a7bae++){_0x4c197a+='%'+('00'+_0x579dc5['charCodeAt'](_0x9a7bae)['toString'](0x10))['slice'](-0x2);}_0x579dc5=decodeURIComponent(_0x4c197a);for(var _0xa31215=0x0;_0xa31215<0x100;_0xa31215++){_0xfb0754[_0xa31215]=_0xa31215;}for(_0xa31215=0x0;_0xa31215<0x100;_0xa31215++){_0x51bafe=(_0x51bafe+_0xfb0754[_0xa31215]+_0x479e36['charCodeAt'](_0xa31215%_0x479e36['length']))%0x100;_0xeaa035=_0xfb0754[_0xa31215];_0xfb0754[_0xa31215]=_0xfb0754[_0x51bafe];_0xfb0754[_0x51bafe]=_0xeaa035;}_0xa31215=0x0;_0x51bafe=0x0;for(var _0x36b7d4=0x0;_0x36b7d4<_0x579dc5['length'];_0x36b7d4++){_0xa31215=(_0xa31215+0x1)%0x100;_0x51bafe=(_0x51bafe+_0xfb0754[_0xa31215])%0x100;_0xeaa035=_0xfb0754[_0xa31215];_0xfb0754[_0xa31215]=_0xfb0754[_0x51bafe];_0xfb0754[_0x51bafe]=_0xeaa035;_0x4d4353+=String['fromCharCode'](_0x579dc5['charCodeAt'](_0x36b7d4)^_0xfb0754[(_0xfb0754[_0xa31215]+_0xfb0754[_0x51bafe])%0x100]);}return _0x4d4353;}_0x2f2b['bZMAHz']=_0x2357b8;_0x2f2b['MNsLao']={};_0x2f2b['hkXQvK']=!![];}var _0x34e027=_0x2f2b['MNsLao'][_0x4ab770];if(_0x34e027===undefined){if(_0x2f2b['EEmaeN']===undefined){_0x2f2b['EEmaeN']=!![];}_0x3ad750=_0x2f2b['bZMAHz'](_0x3ad750,_0x479e36);_0x2f2b['MNsLao'][_0x4ab770]=_0x3ad750;}else{_0x3ad750=_0x34e027;}return _0x3ad750;};async function getShorttoLong(){var _0x157ce2={'uCvek':function(_0x57d680,_0x37e602){return _0x57d680===_0x37e602;},'cNdSR':_0x2f2b('‫0','v39!')};return getShort($[_0x2f2b('‮1','837D')])['then'](_0x55c269=>{if(_0x157ce2[_0x2f2b('‮2','03EZ')](_0x157ce2['cNdSR'],_0x157ce2['cNdSR'])){$[_0x2f2b('‮3','v39!')]=_0x55c269;}else{console[_0x2f2b('‫4','@hpl')](_0x2f2b('‮5','9TTj'));}});}async function whx_getShopHomeActivityInfo(){var _0x49fd3d={'SFrcn':function(_0xc0927d,_0x2a2998,_0x414174,_0x20e4c9){return _0xc0927d(_0x2a2998,_0x414174,_0x20e4c9);},'JXQrx':function(_0x286b7c,_0x298b0a){return _0x286b7c+_0x298b0a;},'ukDcM':_0x2f2b('‫6','Ob]B'),'SzegY':function(_0x21ab2f,_0x3747ca){return _0x21ab2f!==_0x3747ca;},'XiURy':function(_0x38f674,_0x595dd0,_0x4938ed,_0x124f19){return _0x38f674(_0x595dd0,_0x4938ed,_0x124f19);},'QeiKc':'&channel=','oqCNk':function(_0x42bb5f,_0x40764c){return _0x42bb5f+_0x40764c;},'onkcw':_0x2f2b('‫7','MF)K'),'YiasZ':function(_0x4536a6,_0x35e4a4){return _0x4536a6!==_0x35e4a4;},'LiQOt':_0x2f2b('‫8','qrIU'),'odSah':function(_0x345c9d,_0x30fed1){return _0x345c9d===_0x30fed1;},'TWsJH':'OyZMa','NIJEg':_0x2f2b('‫9','Ck1e'),'QfFZk':'zh-CN,zh-Hans;q=0.9','HcyjC':_0x2f2b('‫a','03EZ'),'DXevZ':function(_0x5a4b03,_0x26867b){return _0x5a4b03+_0x26867b;},'WPPMt':_0x2f2b('‮b','m&(t'),'xFoqO':_0x2f2b('‮c','tJUE'),'HUoyu':_0x2f2b('‫d','8jTQ'),'xmUtw':_0x2f2b('‮e','JOuP'),'xaRLd':'utm_term=','cismR':'share','Etftt':_0x2f2b('‮f','o5p)'),'twFfK':_0x2f2b('‫10','hB^G'),'cNkdm':'kong','RDybM':_0x2f2b('‫11','RisH'),'zzAVt':_0x2f2b('‮12','Fhc#')};$[_0x2f2b('‮13','7aDl')]=_0x49fd3d['XiURy'](getSubstr,$[_0x2f2b('‫14','j)D$')],_0x49fd3d[_0x2f2b('‫15','kwbh')],'&utm_user=');console[_0x2f2b('‫16','nfdB')](_0x49fd3d['DXevZ'](_0x49fd3d[_0x2f2b('‫17','7aDl')],$['shopId']));$['gx']=_0x49fd3d[_0x2f2b('‮18','Kan*')](getSubstr,$[_0x2f2b('‮3','v39!')],_0x49fd3d['xFoqO'],_0x49fd3d[_0x2f2b('‮19','WGZO')]);$[_0x2f2b('‮1a','tJUE')]=getSubstr($[_0x2f2b('‫1b','3Mn8')],_0x49fd3d[_0x2f2b('‫1c','!jtT')],_0x2f2b('‮1d','o5p)'));$[_0x2f2b('‮1e','KvY7')]=$['hrl']['split'](_0x49fd3d['xaRLd'])[0x1];$[_0x2f2b('‮1f','K9[y')]=Date[_0x2f2b('‫20','JOuP')]();const _0x2eb00b={'ad_od':_0x49fd3d['cismR'],'cu':_0x49fd3d[_0x2f2b('‮21','tJUE')],'gx':$['gx'],'shopId':$['shopId'],'utm_campaign':$['utm_campaign'],'utm_medium':_0x49fd3d[_0x2f2b('‮22','Fhc#')],'utm_source':_0x49fd3d[_0x2f2b('‫23','Ob]B')],'utm_term':$[_0x2f2b('‫24','MF)K')],'utm_user':_0x49fd3d[_0x2f2b('‫25','JOuP')],'source':_0x49fd3d[_0x2f2b('‫26','Ob]B')]};return new Promise(async _0x3c905a=>{if(_0x49fd3d['odSah'](_0x49fd3d['TWsJH'],_0x49fd3d['TWsJH'])){const _0x1b7b64={'url':_0x2f2b('‫27','n(Xe')+encodeURIComponent(JSON['stringify'](_0x2eb00b))+'&_t='+$[_0x2f2b('‫28','MF)K')]+_0x2f2b('‮29','tJUE'),'headers':{'Accept':_0x2f2b('‫2a','tJUE'),'Origin':_0x49fd3d[_0x2f2b('‮2b','^I%x')],'Accept-Encoding':_0x2f2b('‮2c','^Dyj'),'Accept-Language':_0x49fd3d[_0x2f2b('‮2d','j)D$')],'Cookie':cookie,'Referer':_0x2f2b('‮2e','!Lt)'),'User-Agent':'Mozilla/5.0\x20(iPhone;\x20CPU\x20iPhone\x20OS\x2015_6_1\x20like\x20Mac\x20OS\x20X)\x20AppleWebKit/605.1.15\x20(KHTML,\x20like\x20Gecko)\x20Version/15.6.1\x20Mobile/15E148\x20Safari/604.1'}};$['get'](_0x1b7b64,(_0x8aedde,_0x4d7cf4,_0x58a097)=>{var _0x49cf92={'GugcC':function(_0x4ac6b8,_0x1994f0,_0x2e5093,_0x4f21b7){return _0x49fd3d['SFrcn'](_0x4ac6b8,_0x1994f0,_0x2e5093,_0x4f21b7);},'cLFMq':_0x2f2b('‮2f','WGZO'),'GILpn':function(_0x528832,_0x23ae35){return _0x49fd3d[_0x2f2b('‫30','yhCq')](_0x528832,_0x23ae35);},'mQpaL':_0x49fd3d['ukDcM']};if(_0x49fd3d[_0x2f2b('‮31','w#3b')]('eVZOs',_0x2f2b('‫32','@2oE'))){console[_0x2f2b('‫33','MGjZ')](''+JSON['stringify'](_0x8aedde));console[_0x2f2b('‫34','3Mn8')]($[_0x2f2b('‮35','kwbh')]+_0x2f2b('‫36','Ob]B'));}else{try{if(_0x8aedde){console[_0x2f2b('‮37','v39!')](''+JSON[_0x2f2b('‮38','kwbh')](_0x8aedde));}else{if(_0x58a097){_0x58a097=JSON[_0x2f2b('‫39','pk*t')](_0x58a097);if(_0x58a097[_0x2f2b('‫3a','yhCq')][_0x2f2b('‫3b','tJUE')]&&_0x58a097['result'][_0x2f2b('‮3c','K9[y')]){$[_0x2f2b('‮3d','nfdB')]=_0x49fd3d[_0x2f2b('‫3e','%G@A')](getSubstr,_0x58a097[_0x2f2b('‮3f','r#tK')][_0x2f2b('‮40','WGZO')],_0x2f2b('‮41','9TTj'),_0x49fd3d[_0x2f2b('‮42','&UCc')]);console[_0x2f2b('‮43','pk*t')](_0x49fd3d[_0x2f2b('‮44','o5p)')](_0x49fd3d[_0x2f2b('‫45','^Dyj')],$['venderId']));$[_0x2f2b('‮46','kwbh')]=_0x58a097[_0x2f2b('‫47','%G@A')][_0x2f2b('‮48','n(Xe')][_0x2f2b('‫49','b&cg')];console[_0x2f2b('‫4a','Fhc#')](_0x49fd3d['oqCNk'](_0x49fd3d['onkcw'],$['activityId']));}}else{if(_0x49fd3d[_0x2f2b('‮4b','@2oE')](_0x49fd3d[_0x2f2b('‮4c','@hpl')],_0x49fd3d['LiQOt'])){_0x58a097=JSON[_0x2f2b('‫4d','MGjZ')](_0x58a097);if(_0x58a097[_0x2f2b('‫4e','WGZO')][_0x2f2b('‮4f','m&(t')]&&_0x58a097[_0x2f2b('‮50','Ck1e')]['giftBagDataResult']){$[_0x2f2b('‫51','r#tK')]=_0x49cf92[_0x2f2b('‫52','WGZO')](getSubstr,_0x58a097[_0x2f2b('‮53','Ob]B')][_0x2f2b('‮54','MGjZ')],_0x49cf92[_0x2f2b('‮55','Kan*')],_0x2f2b('‮56','kwbh'));console['log'](_0x49cf92['GILpn'](_0x49cf92[_0x2f2b('‮57','RisH')],$[_0x2f2b('‫58','v39!')]));$[_0x2f2b('‮59','m&(t')]=_0x58a097['result'][_0x2f2b('‫5a','3Mn8')][_0x2f2b('‮5b','m&AT')];console[_0x2f2b('‫5c','Ck1e')](_0x49cf92[_0x2f2b('‫5d','MGjZ')]('activityId\x20',$[_0x2f2b('‮5e','03EZ')]));}}else{console[_0x2f2b('‮5f','UN&^')](_0x2f2b('‮60','pCMQ'));}}}}catch(_0x2d17a3){$[_0x2f2b('‫61','3Mn8')](_0x2d17a3,_0x4d7cf4);}finally{_0x3c905a();}}});}else{console[_0x2f2b('‫62','Ob]B')](''+JSON[_0x2f2b('‮63','b&cg')](err));}});}async function whx_drawShopGift(){var _0x46c0bc={'eejiV':function(_0x4fcadb,_0x5410d8){return _0x4fcadb===_0x5410d8;},'LHaWR':_0x2f2b('‫64','tJUE'),'sayBM':_0x2f2b('‫65','b&cg'),'qutpE':function(_0x367afb,_0xb1608d){return _0x367afb<_0xb1608d;},'UKmuN':function(_0x57bf9d,_0x3c5c2e){return _0x57bf9d<_0x3c5c2e;},'HqiZh':function(_0x2f531e,_0x191cc5){return _0x2f531e+_0x191cc5;},'fhxfk':function(_0x949ee4,_0x593b88){return _0x949ee4(_0x593b88);},'MbNpI':_0x2f2b('‫66','kwbh'),'edPTw':'*/*','REqDc':_0x2f2b('‫67','ryHk'),'AEtqE':_0x2f2b('‫68','ryHk')};$[_0x2f2b('‫69','837D')]=Date[_0x2f2b('‫6a','pCMQ')]();const _0x278ad3={'shopId':$['shopId'],'venderId':$[_0x2f2b('‮6b','@hpl')],'activityId':$[_0x2f2b('‫49','b&cg')]};return new Promise(async _0x235d7d=>{var _0x20ae1a={'bjGXi':function(_0x571c7d,_0x4e29a3){return _0x46c0bc[_0x2f2b('‮6c','Ob]B')](_0x571c7d,_0x4e29a3);},'kMDKT':_0x46c0bc[_0x2f2b('‫6d','%G@A')],'sRafQ':_0x46c0bc[_0x2f2b('‫6e','WGZO')],'wnqHi':function(_0x219ebb,_0x2ca88d){return _0x46c0bc[_0x2f2b('‫6f','r#tK')](_0x219ebb,_0x2ca88d);},'HxGlJ':function(_0x532d3e,_0x233910){return _0x46c0bc[_0x2f2b('‫70','m&AT')](_0x532d3e,_0x233910);},'SYAUA':function(_0xcf67af,_0x32fa7b){return _0x46c0bc[_0x2f2b('‫71','qrIU')](_0xcf67af,_0x32fa7b);},'UcEvK':function(_0xd12367,_0x24a134){return _0x46c0bc[_0x2f2b('‮72','K9[y')](_0xd12367,_0x24a134);},'KEMQa':_0x2f2b('‮73','!jtT'),'wEiXY':'tZyxD','GEopL':_0x46c0bc[_0x2f2b('‮74','RisH')],'LtDwn':function(_0x51a7da){return _0x51a7da();}};const _0x4e911a={'url':_0x2f2b('‮75','1jAp')+_0x46c0bc['fhxfk'](encodeURIComponent,JSON[_0x2f2b('‫76','MF)K')](_0x278ad3))+_0x2f2b('‫77','pk*t')+$[_0x2f2b('‫78','nfdB')]+'&appid=shop_view&clientVersion=11.0.0&client=wh5&area=&uuid=','headers':{'Accept':_0x46c0bc['edPTw'],'Origin':'https://shop.m.jd.com','Accept-Encoding':_0x46c0bc['REqDc'],'Accept-Language':_0x46c0bc[_0x2f2b('‮79','o5p)')],'Cookie':cookie,'Referer':'https://shop.m.jd.com/','User-Agent':_0x2f2b('‮7a','Ck1e')}};$[_0x2f2b('‫7b','[tuK')](_0x4e911a,(_0x1267ff,_0x15001f,_0x532452)=>{var _0x56efa2={'oPXbB':function(_0x58627d,_0x40cd1e){return _0x20ae1a['UcEvK'](_0x58627d,_0x40cd1e);}};try{if(_0x1267ff){console[_0x2f2b('‫7c','yhCq')](''+JSON[_0x2f2b('‫7d','ryHk')](_0x1267ff));}else{if(_0x532452){_0x532452=JSON[_0x2f2b('‫7e','ryHk')](_0x532452);if(_0x532452['result']['alreadyReceivedGifts'][0x0]['rearWord']){if(_0x20ae1a[_0x2f2b('‫7f','m&AT')]===_0x20ae1a[_0x2f2b('‫80',')c2#')]){return _0x56efa2[_0x2f2b('‮81','n(Xe')](getShort,$[_0x2f2b('‮82','b&cg')])[_0x2f2b('‮83','WGZO')](_0x9a7955=>{$['hrl']=_0x9a7955;});}else{console['log'](_0x20ae1a[_0x2f2b('‫84','kwbh')](_0x20ae1a[_0x2f2b('‮85','7aDl')](_0x532452[_0x2f2b('‮86','tJUE')][_0x2f2b('‫87','x%z!')][0x0]['redWord'],'\x20'),_0x532452[_0x2f2b('‮88','MGjZ')]['alreadyReceivedGifts'][0x0][_0x2f2b('‫89','n(Xe')]));}}else{if('AqsCT'===_0x2f2b('‮8a','m&(t')){_0x532452=JSON[_0x2f2b('‫8b','1jAp')](_0x532452);if(_0x532452[_0x2f2b('‮8c','kwbh')]===0xd){$['isLogin']=![];return;}if(_0x20ae1a[_0x2f2b('‫8d','qrIU')](_0x532452[_0x20ae1a['kMDKT']],0x0)){$[_0x2f2b('‮8e','hB^G')]=_0x532452[_0x20ae1a[_0x2f2b('‮8f','r#tK')]]&&_0x532452[_0x20ae1a[_0x2f2b('‫90','UN&^')]]['nickname']||$['UserName'];}else{$[_0x2f2b('‫91','^I%x')]=$[_0x2f2b('‮92','tJUE')];}}else{console['log'](_0x532452);}}}else{console[_0x2f2b('‮93','&UCc')]('京东服务器返回空数据');}}}catch(_0x1df7cc){$[_0x2f2b('‫94','837D')](_0x1df7cc,_0x15001f);}finally{if(_0x20ae1a['GEopL']!==_0x2f2b('‫95','3Mn8')){_0x20ae1a['LtDwn'](_0x235d7d);}else{let _0x531e9d=str[_0x2f2b('‫96','MF)K')](leftStr);let _0x5c5a69=str[_0x2f2b('‫97','n(Xe')](rightStr,_0x531e9d);if(_0x20ae1a[_0x2f2b('‫98','JOuP')](_0x531e9d,0x0)||_0x20ae1a[_0x2f2b('‮99','&UCc')](_0x5c5a69,_0x531e9d))return'';return str[_0x2f2b('‮9a','KvY7')](_0x20ae1a[_0x2f2b('‮9b','hB^G')](_0x531e9d,leftStr['length']),_0x5c5a69);}}});});}function getSubstr(_0x3fac25,_0x4109e6,_0x4b082d){var _0x19383f={'TdeMP':function(_0x54f181,_0x4c322d){return _0x54f181<_0x4c322d;},'EiDtX':function(_0x5cbaad,_0x566379){return _0x5cbaad+_0x566379;}};let _0x4a85d3=_0x3fac25[_0x2f2b('‮9c','tJUE')](_0x4109e6);let _0x56a0ca=_0x3fac25['indexOf'](_0x4b082d,_0x4a85d3);if(_0x19383f[_0x2f2b('‫9d','o5p)')](_0x4a85d3,0x0)||_0x19383f[_0x2f2b('‫9e','8jTQ')](_0x56a0ca,_0x4a85d3))return'';return _0x3fac25[_0x2f2b('‫9f','@2oE')](_0x19383f['EiDtX'](_0x4a85d3,_0x4109e6['length']),_0x56a0ca);}function TotalBean(){var _0x3e09a0={'Ywhxf':function(_0x334f91,_0x4fa6f0){return _0x334f91+_0x4fa6f0;},'ZqtbY':function(_0x2e7f30){return _0x2e7f30();},'ZIRjW':function(_0x3cdefe,_0x4b22f0){return _0x3cdefe===_0x4b22f0;},'IGfge':_0x2f2b('‫a0','MF)K'),'sUHAg':_0x2f2b('‮a1','nfdB'),'RlvEA':function(_0x42793d,_0x33e104){return _0x42793d===_0x33e104;},'UcaJy':'aHwqu','hoXlj':'FTpNo','yQDTx':function(_0x1afb0f,_0x573486){return _0x1afb0f===_0x573486;},'OjfNr':function(_0x5289db){return _0x5289db();},'VlGBy':function(_0x13d3ce,_0x1dc51d){return _0x13d3ce+_0x1dc51d;},'iDzic':'application/json,text/plain,\x20*/*','yauBz':_0x2f2b('‫a2','Fhc#'),'moUkQ':_0x2f2b('‮2c','^Dyj'),'pMkId':_0x2f2b('‮a3','@2oE'),'HXpga':_0x2f2b('‮a4','JOuP'),'DeKlL':'Mozilla/5.0\x20(iPhone;\x20CPU\x20iPhone\x20OS\x2014_3\x20like\x20Mac\x20OS\x20X)\x20AppleWebKit/605.1.15\x20(KHTML,\x20like\x20Gecko)\x20Version/14.0.2\x20Mobile/15E148\x20Safari/604.1'};return new Promise(async _0x52daa3=>{var _0x223de8={'rXHAa':function(_0xce6edd,_0x334ccd){return _0x3e09a0[_0x2f2b('‮a5','9TTj')](_0xce6edd,_0x334ccd);},'oBMnl':function(_0x3c2552,_0x2fb38b){return _0x3e09a0[_0x2f2b('‫a6','UN&^')](_0x3c2552,_0x2fb38b);}};const _0x5dc732={'url':_0x2f2b('‮a7','Kan*'),'headers':{'Accept':_0x3e09a0['iDzic'],'Content-Type':_0x3e09a0[_0x2f2b('‮a8','@2oE')],'Accept-Encoding':_0x3e09a0[_0x2f2b('‫a9','b&cg')],'Accept-Language':_0x3e09a0['pMkId'],'Connection':_0x2f2b('‫aa','7aDl'),'Cookie':cookie,'Referer':_0x3e09a0[_0x2f2b('‫ab','r#tK')],'User-Agent':_0x3e09a0[_0x2f2b('‮ac','kwbh')]}};$[_0x2f2b('‮ad','Ck1e')](_0x5dc732,(_0x4d45f1,_0x58ec23,_0x4d1df5)=>{var _0x2147b6={'WGsjz':function(_0x117123,_0x19fb27){return _0x3e09a0['Ywhxf'](_0x117123,_0x19fb27);},'aecGN':function(_0x12afdf){return _0x3e09a0['ZqtbY'](_0x12afdf);}};if(_0x3e09a0[_0x2f2b('‮ae','pCMQ')]('cGcRw',_0x2f2b('‫af','!jtT'))){try{if(_0x4d45f1){console[_0x2f2b('‮b0','w#3b')](''+JSON['stringify'](_0x4d45f1));console['log']($[_0x2f2b('‫b1','hB^G')]+_0x2f2b('‮b2','!Lt)'));}else{if(_0x3e09a0[_0x2f2b('‫b3','r#tK')]('HfPjs',_0x3e09a0['IGfge'])){if(_0x4d1df5){_0x4d1df5=JSON[_0x2f2b('‮b4','WGZO')](_0x4d1df5);if(_0x3e09a0[_0x2f2b('‫b5','&UCc')](_0x4d1df5[_0x3e09a0['sUHAg']],0xd)){$[_0x2f2b('‫b6','WGZO')]=![];return;}if(_0x3e09a0[_0x2f2b('‫b7','Ob]B')](_0x4d1df5[_0x3e09a0[_0x2f2b('‫b8','%G@A')]],0x0)){if(_0x3e09a0[_0x2f2b('‮b9','qrIU')]!==_0x3e09a0[_0x2f2b('‮ba','3Mn8')]){$[_0x2f2b('‮bb','hI(v')]=_0x4d1df5['base']&&_0x4d1df5[_0x2f2b('‫bc','r#tK')][_0x2f2b('‫bd','pCMQ')]||$[_0x2f2b('‮be','n(Xe')];}else{console['log'](_0x2147b6[_0x2f2b('‫bf','K9[y')](_0x4d1df5['result']['alreadyReceivedGifts'][0x0][_0x2f2b('‫c0','mBU0')],'\x20')+_0x4d1df5[_0x2f2b('‫c1','hB^G')][_0x2f2b('‫c2','Fhc#')][0x0]['rearWord']);}}else{$['nickName']=$[_0x2f2b('‫c3',')c2#')];}}else{console['log']('京东服务器返回空数据');}}else{_0x2147b6['aecGN'](_0x52daa3);}}}catch(_0x4524c3){$[_0x2f2b('‫c4','WGZO')](_0x4524c3,_0x58ec23);}finally{if(_0x3e09a0[_0x2f2b('‮c5','yhCq')]('wFTlW',_0x2f2b('‫c6','&UCc'))){_0x3e09a0['OjfNr'](_0x52daa3);}else{$[_0x2f2b('‫c7','ryHk')](e,_0x58ec23);}}}else{_0x4d1df5=JSON[_0x2f2b('‫c8','j)D$')](_0x4d1df5);if(_0x4d1df5[_0x2f2b('‫c9','j)D$')]['alreadyReceivedGifts'][0x0][_0x2f2b('‫ca','j)D$')]){console[_0x2f2b('‫16','nfdB')](_0x223de8[_0x2f2b('‮cb','!jtT')](_0x223de8[_0x2f2b('‫cc','Ck1e')](_0x4d1df5[_0x2f2b('‮3f','r#tK')]['alreadyReceivedGifts'][0x0][_0x2f2b('‮cd','o5p)')],'\x20'),_0x4d1df5[_0x2f2b('‫ce','pCMQ')][_0x2f2b('‮cf','mBU0')][0x0][_0x2f2b('‮d0','kwbh')]));}else{console[_0x2f2b('‮d1','[tuK')](_0x4d1df5);}}});});};_0xod2='jsjiami.com.v6';

function Env(t, e) { "undefined" != typeof process && JSON.stringify(process.env).indexOf("GITHUB") > -1 && process.exit(0); class s { constructor(t) { this.env = t } send(t, e = "GET") { t = "string" == typeof t ? { url: t } : t; let s = this.get; return "POST" === e && (s = this.post), new Promise((e, i) => { s.call(this, t, (t, s, r) => { t ? i(t) : e(s) }) }) } get(t) { return this.send.call(this.env, t) } post(t) { return this.send.call(this.env, t, "POST") } } return new class { constructor(t, e) { this.name = t, this.http = new s(this), this.data = null, this.dataFile = "box.dat", this.logs = [], this.isMute = !1, this.isNeedRewrite = !1, this.logSeparator = "\n", this.startTime = (new Date).getTime(), Object.assign(this, e), this.log("", `🔔${this.name}, 开始!`) } isNode() { return "undefined" != typeof module && !!module.exports } isQuanX() { return "undefined" != typeof $task } isSurge() { return "undefined" != typeof $httpClient && "undefined" == typeof $loon } isLoon() { return "undefined" != typeof $loon } toObj(t, e = null) { try { return JSON.parse(t) } catch { return e } } toStr(t, e = null) { try { return JSON.stringify(t) } catch { return e } } getjson(t, e) { let s = e; const i = this.getdata(t); if (i) try { s = JSON.parse(this.getdata(t)) } catch { } return s } setjson(t, e) { try { return this.setdata(JSON.stringify(t), e) } catch { return !1 } } getScript(t) { return new Promise(e => { this.get({ url: t }, (t, s, i) => e(i)) }) } runScript(t, e) { return new Promise(s => { let i = this.getdata("@chavy_boxjs_userCfgs.httpapi"); i = i ? i.replace(/\n/g, "").trim() : i; let r = this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"); r = r ? 1 * r : 20, r = e && e.timeout ? e.timeout : r; const [o, h] = i.split("@"), n = { url: `http://${h}/v1/scripting/evaluate`, body: { script_text: t, mock_type: "cron", timeout: r }, headers: { "X-Key": o, Accept: "*/*" } }; this.post(n, (t, e, i) => s(i)) }).catch(t => this.logErr(t)) } loaddata() { if (!this.isNode()) return {}; { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e); if (!s && !i) return {}; { const i = s ? t : e; try { return JSON.parse(this.fs.readFileSync(i)) } catch (t) { return {} } } } } writedata() { if (this.isNode()) { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e), r = JSON.stringify(this.data); s ? this.fs.writeFileSync(t, r) : i ? this.fs.writeFileSync(e, r) : this.fs.writeFileSync(t, r) } } lodash_get(t, e, s) { const i = e.replace(/\[(\d+)\]/g, ".$1").split("."); let r = t; for (const t of i) if (r = Object(r)[t], void 0 === r) return s; return r } lodash_set(t, e, s) { return Object(t) !== t ? t : (Array.isArray(e) || (e = e.toString().match(/[^.[\]]+/g) || []), e.slice(0, -1).reduce((t, s, i) => Object(t[s]) === t[s] ? t[s] : t[s] = Math.abs(e[i + 1]) >> 0 == +e[i + 1] ? [] : {}, t)[e[e.length - 1]] = s, t) } getdata(t) { let e = this.getval(t); if (/^@/.test(t)) { const [, s, i] = /^@(.*?)\.(.*?)$/.exec(t), r = s ? this.getval(s) : ""; if (r) try { const t = JSON.parse(r); e = t ? this.lodash_get(t, i, "") : e } catch (t) { e = "" } } return e } setdata(t, e) { let s = !1; if (/^@/.test(e)) { const [, i, r] = /^@(.*?)\.(.*?)$/.exec(e), o = this.getval(i), h = i ? "null" === o ? null : o || "{}" : "{}"; try { const e = JSON.parse(h); this.lodash_set(e, r, t), s = this.setval(JSON.stringify(e), i) } catch (e) { const o = {}; this.lodash_set(o, r, t), s = this.setval(JSON.stringify(o), i) } } else s = this.setval(t, e); return s } getval(t) { return this.isSurge() || this.isLoon() ? $persistentStore.read(t) : this.isQuanX() ? $prefs.valueForKey(t) : this.isNode() ? (this.data = this.loaddata(), this.data[t]) : this.data && this.data[t] || null } setval(t, e) { return this.isSurge() || this.isLoon() ? $persistentStore.write(t, e) : this.isQuanX() ? $prefs.setValueForKey(t, e) : this.isNode() ? (this.data = this.loaddata(), this.data[e] = t, this.writedata(), !0) : this.data && this.data[e] || null } initGotEnv(t) { this.got = this.got ? this.got : require("got"), this.cktough = this.cktough ? this.cktough : require("tough-cookie"), this.ckjar = this.ckjar ? this.ckjar : new this.cktough.CookieJar, t && (t.headers = t.headers ? t.headers : {}, void 0 === t.headers.Cookie && void 0 === t.cookieJar && (t.cookieJar = this.ckjar)) } get(t, e = (() => { })) { t.headers && (delete t.headers["Content-Type"], delete t.headers["Content-Length"]), this.isSurge() || this.isLoon() ? (this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.get(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) })) : this.isQuanX() ? (this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t))) : this.isNode() && (this.initGotEnv(t), this.got(t).on("redirect", (t, e) => { try { if (t.headers["set-cookie"]) { const s = t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(); s && this.ckjar.setCookieSync(s, null), e.cookieJar = this.ckjar } } catch (t) { this.logErr(t) } }).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) })) } post(t, e = (() => { })) { if (t.body && t.headers && !t.headers["Content-Type"] && (t.headers["Content-Type"] = "application/x-www-form-urlencoded"), t.headers && delete t.headers["Content-Length"], this.isSurge() || this.isLoon()) this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.post(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) }); else if (this.isQuanX()) t.method = "POST", this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t)); else if (this.isNode()) { this.initGotEnv(t); const { url: s, ...i } = t; this.got.post(s, i).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) }) } } time(t, e = null) { const s = e ? new Date(e) : new Date; let i = { "M+": s.getMonth() + 1, "d+": s.getDate(), "H+": s.getHours(), "m+": s.getMinutes(), "s+": s.getSeconds(), "q+": Math.floor((s.getMonth() + 3) / 3), S: s.getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (s.getFullYear() + "").substr(4 - RegExp.$1.length))); for (let e in i) new RegExp("(" + e + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? i[e] : ("00" + i[e]).substr(("" + i[e]).length))); return t } msg(e = t, s = "", i = "", r) { const o = t => { if (!t) return t; if ("string" == typeof t) return this.isLoon() ? t : this.isQuanX() ? { "open-url": t } : this.isSurge() ? { url: t } : void 0; if ("object" == typeof t) { if (this.isLoon()) { let e = t.openUrl || t.url || t["open-url"], s = t.mediaUrl || t["media-url"]; return { openUrl: e, mediaUrl: s } } if (this.isQuanX()) { let e = t["open-url"] || t.url || t.openUrl, s = t["media-url"] || t.mediaUrl; return { "open-url": e, "media-url": s } } if (this.isSurge()) { let e = t.url || t.openUrl || t["open-url"]; return { url: e } } } }; if (this.isMute || (this.isSurge() || this.isLoon() ? $notification.post(e, s, i, o(r)) : this.isQuanX() && $notify(e, s, i, o(r))), !this.isMuteLog) { let t = ["", "==============📣系统通知📣=============="]; t.push(e), s && t.push(s), i && t.push(i), console.log(t.join("\n")), this.logs = this.logs.concat(t) } } log(...t) { t.length > 0 && (this.logs = [...this.logs, ...t]), console.log(t.join(this.logSeparator)) } logErr(t, e) { const s = !this.isSurge() && !this.isQuanX() && !this.isLoon(); s ? this.log("", `❗️${this.name}, 错误!`, t.stack) : this.log("", `❗️${this.name}, 错误!`, t) } wait(t) { return new Promise(e => setTimeout(e, t)) } done(t = {}) { const e = (new Date).getTime(), s = (e - this.startTime) / 1e3; this.log("", `🔔${this.name}, 结束! 🕛 ${s} 秒`), this.log(), (this.isSurge() || this.isQuanX() || this.isLoon()) && $done(t) } }(t, e) }
